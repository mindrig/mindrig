---
import { getCollection } from "astro:content";
import ContentLayout from "../../layouts/Content.astro";
import { textCn } from "@wrkspc/theme";
import { marked } from "marked";
import { Icon } from "@wrkspc/icons";
import iconRegularArrowRight from "@wrkspc/icons/svg/regular/arrow-right.js";
import { ContentHeader } from "../../components/ContentHeader";

const posts = await getCollection("blog");
posts.sort((a, b) => +b.data.publishedAt - +a.data.publishedAt);
---

<ContentLayout title="Mind Rig Blog">
  <main class="flex flex-col items-center w-full">
    <ContentHeader
      title="Mind Rig Blog"
      subtitle="Case studies, feature highlights and announcements."
    />

    <ol class="w-full max-w-2xl divide-y divide-gray-200">
      {
        posts.map((post) => {
          const href = `/blog/${post.slug}`;
          return (
            <li class="px-4 py-6 md:px-12 md:py-16 space-y-4 md:space-y-6">
              <div class="space-y-2">
                <time
                  datetime={post.data.publishedAt.toISOString()}
                  class={textCn({
                    role: "body",
                    color: "detail",
                    className: "block",
                  })}
                >
                  {post.data.publishedAt.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })}
                </time>

                <a href={href} class="block">
                  <h2 class={textCn({ role: "header" })}>{post.data.title}</h2>
                </a>
              </div>

              <div
                set:html={marked.parse(post.data.summary)}
                class={textCn({ role: "content", color: "support" })}
              />

              <div>
                <a
                  href={href}
                  class="flex items-center gap-2 text-blue-950 hover:text-blue-700 font-medium"
                >
                  Read more
                  <Icon
                    id={iconRegularArrowRight}
                    size="xsmall"
                    color="support"
                  />
                </a>
              </div>
            </li>
          );
        })
      }
    </ol>
  </main>
</ContentLayout>
