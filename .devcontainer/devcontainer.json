{
  "name": "mindrig",

  "build": { "dockerfile": "Dockerfile", "context": ".." },

  // Put repo to /wrkspc
  "workspaceMount": "source=${localWorkspaceFolder},target=/wrkspc/${localWorkspaceFolderBasename},type=bind,consistency=cached",
  "workspaceFolder": "/wrkspc/${localWorkspaceFolderBasename}",

  "mounts": [
    // Mount credentials from host machine:
    "source=${localEnv:HOME}/.config/fnox/age.txt,target=/home/vscode/.config/fnox/age.txt,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.config/mothership/.env,target=/home/vscode/.config/mothership/.env,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.cargo/credentials.toml,target=/home/vscode/.cargo/credentials.toml,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.npmrc,target=/home/vscode/.npmrc,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.codex/auth.json,target=/home/vscode/.codex/auth.json,type=bind,consistency=cached",
    // Mount state directories from local directory:
    "source=${localEnv:HOME}/.local/state/mothership/containers/${devcontainerId}/.cache,target=/home/vscode/.cache,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.local/state/mothership/containers/${devcontainerId}/.local/share,target=/home/vscode/.local/share,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.local/state/mothership/containers/${devcontainerId}/.local/state,target=/home/vscode/.local/state,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.local/state/mothership/containers/${devcontainerId}/.rustup,target=/home/vscode/.rustup,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.local/state/mothership/containers/${devcontainerId}/.codex/sessions,target=/home/vscode/.codex/sessions,type=bind,consistency=cached"
    // NOTE: When adding new mounts, make sure to also update ./Dockerfile to ensure the directories
  ],

  "initializeCommand": ".devcontainer/scripts/initialize.sh ${devcontainerId}",
  "onCreateCommand": ".devcontainer/scripts/on-create.sh",
  "postCreateCommand": ".devcontainer/scripts/post-create.sh",
  "updateContentCommand": ".devcontainer/scripts/on-update.sh",
  "postStartCommand": ".devcontainer/scripts/post-start.sh",

  "features": {
    // TODO: Breaks the build, investigate later.
    // "ghcr.io/devcontainers-extra/features/vscode-server:1": {},
    "ghcr.io/devcontainers-extra/features/vscode-cli:1": {}
  },

  "containerEnv": {
    "DEVCONTAINER": "true"
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "tamasfe.even-better-toml",
        "nefrob.vscode-just-syntax",
        "docker.docker",
        "esbenp.prettier-vscode",
        "hverlin.mise-vscode",
        "tekumara.typos-vscode",
        "davidlday.languagetool-linter",
        "ms-vscode.extension-test-runner",
        "Anthropic.claude-code",
        "rust-lang.rust-analyzer",
        "vadimcn.vscode-lldb",
        "Vercel.turbo-vsc",
        "mitsuhiko.insta",
        "oxc.oxc-vscode",
        "bradlc.vscode-tailwindcss",
        // TODO: Vitest extension struggles to find `node` and given that we
        // have many packages, it spams failing VS Code terminals on startup.
        // Find a way to address this and re-enable the extension.
        // "vitest.explorer",
        "zoma.vscode-auto-open-workspace",
        "MermaidChart.vscode-mermaid-chart",
        "astro-build.astro-vscode"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "fish",
        "terminal.integrated.profiles.linux": {
          "fish": { "path": "/usr/bin/fish" }
        },
        "mise.binPath": "/home/vscode/.local/bin/mise",
        "autoOpenWorkspace.enableAutoOpenAlwaysFirst": true
      }
    }
  }
}
